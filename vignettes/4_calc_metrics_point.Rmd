---
title: "4. Calculate metrics on what is happening over time in a given pixel."
author: "Victoria Delannoy, Nicolas Loiseau, Sébastien Villéger"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{4. Calculate metrics on what is happening over time in a given pixel.}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Aims of the function *BEE.calc.metrics_point()*.
The function compute daily metrics or average metric per extreme event on what is happening through time e.g. : maximum anomaly, 


# Usage
## Arguments:
**true_event_raster** The first element of the *BEE.calc.true_event()*
ouput, which is a spatraster binarized that inclued the corrections made by
*BEE.calc.true_event()*.  
**true_event_df** The second element of the *BEE.calc.true_event()* ouput,
which is a list of data.table containing information about the value of each
pixel before and after definition criteria are applied to distinguish
isolated extreme days from extreme events.  
**plot** Accepted values are TRUE of FALSE. Set to “FALSE” to not display
the graphs.

## Warnings:
No warning implemented yet.  
## Messages:
A message will be sent out providing basic information on the number of days that have been reclassified as part of an extreme event, or excluded from one.

## Output
The output is a data frame containing one row for each combination of date and pixel. It contains the count of corrections from 1 to 0 and from 0 to 1, which are provided in case users want to run their own tests. However, the main interest lies in the plots that are created by the function.  
The first plot shows the cumulative percentage of values that have been modified amongst all non-NA values over time. This allows us to visualise whether the corrections are homogeneous over time. If so, the lines drawn should be straight. The same graph also allows you to check whether a similar percentage of non-NA values have been changed to 1 and to 0.  
The second graph allows you to check whether the corrections are homogeneous across the area. It plots the studied area and shows the difference between the number extreme days that have been added and the number  extreme days that have been withdrawn, for each pixel. If a pixel value is negative, it means that, over the entire time period, more extreme days have been removed than added for that pixel.

# Examples
## Load data:
```{r setup}
library(BioExtremeEvent)
#Binarized spatraster corrected built using BEE.calc.true_event()
file_name_1 <- system.file(file.path("extdata", "binarized_corrected_spatraster.tiff"),
                                   package = "BioExtremeEvent")
binarized_corrected_spatraster <- terra::rast(file_name_1)
#List of dataframe containning information about former and corrected binarised values, built using BEE.calc.true_event()
file_name_2 <- system.file(file.path("extdata", "binarized_corrected_df.rds"),
                                   package = "BioExtremeEvent")
binarized_corrected_df <- readRDS(file_name_2)
```

## See how the extreme event definition used in article *3. Identify extreme event according specific constraints.* has modified the number of extreme days.
```{r}
df_count_modif <- BEE.calc.corrections(true_event_raster = binarized_corrected_spatraster,
                                       true_event_df_list = binarized_corrected_df,
                                       plot = TRUE)
```

## How to save the ouputs:

```{r, eval = FALSE}
write.csv(df_count_modif, file = "your_path/data/df_count_modif.csv")
```

