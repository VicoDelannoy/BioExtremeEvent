<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3.1 Identify extreme event according specific constraints • BioExtremeEvent</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="3.1 Identify extreme event according specific constraints">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioExtremeEvent</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/BioExtremeEvent.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/0.1_data_load_corpernicus.html">0.1 Dowload data from Copernicus</a>
    </li>
    <li>
      <a href="../articles/0.2_calc_celsius.html">0.2 Convert temperature data to Celsius</a>
    </li>
    <li>
      <a href="../articles/1.calc_baseline.html">1. Compute a baseline value</a>
    </li>
    <li>
      <a href="../articles/2.calc_binarize.html">2. Compare a time serie with the baseline or fixed threshold</a>
    </li>
    <li>
      <a href="../articles/3.1_calc_true_event.html">3.1 Identify extreme event according specific constraints</a>
    </li>
    <li>
      <a href="../articles/3.2_calc_corrections.html">3.2 Check how much corrected extreme events differ from raw extreme days.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VicoMarbec/BioExtremeEvent/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>3.1 Identify extreme event according specific
constraints</h1>
                        <h4 data-toc-skip class="author">Victoria
Delannoy, Nicolas Loiseau, Sébastien Villéger</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VicoMarbec/BioExtremeEvent/blob/main/vignettes/3.1_calc_true_event.Rmd" class="external-link"><code>vignettes/3.1_calc_true_event.Rmd</code></a></small>
      <div class="hidden name"><code>3.1_calc_true_event.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="aims-of-the-function-bee-calc-true_event">Aims of the function <em>BEE.calc.true_event()</em><a class="anchor" aria-label="anchor" href="#aims-of-the-function-bee-calc-true_event"></a>
</h2>
<p>Identify the extreme event according to a set of constraints
(e.g. minimum duration, merging close events).</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="arguments">Arguments:<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h3>
<p><strong>binarized_spatraster</strong> is a spatraster with one layer
per day. Each layer covers the same area and time is continuous (no
layers are missing). If you are not using a fixed threshold, the
baseline spatraster computed using BEE.calc.baseline() must be computed
using the same dataset as YourSpatraster for comparison without
bias.<br><strong>n</strong> The minimum number of consecutive days above the
baseline/threshol required for a series of days more extrem than the
baseline to be considered as an extreme event (≥).<br><strong>d</strong> The maximum number of days for which two series of
values above the threshold/baseline, separated by some days below the
threshold/baseline, can be considered a single extreme event (the
maximum distance in days between the two events to be merged
&lt;=).<br><strong>nbis</strong> The minimum number of days in a series of 1 to
allow merging with #’ serie of 1 longer than <em>‘n’</em> and distant
from <em>‘d’</em> days or fewer. #’ /! <em>‘nbis’</em> must be inferior
or equal to <em>‘n’</em>. This avoid extending an extreme event for only
a few extreme day. For instance: 0000100111110010000 will be considere
as an extreme event of duration 11 days when only using n = 5 and d= 2.
However, if you set nbis=2, lonely extreme days will not be merged and
the duration of the above event will be 5 days. It allows to be more or
less precautionious on the temporal extent of the extreme event.</p>
</div>
<div class="section level3">
<h3 id="warnings">Warnings:<a class="anchor" aria-label="anchor" href="#warnings"></a>
</h3>
<p>No warning implemented yet.<br>
## Messages: No messages implemented yet.</p>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>Returns a list with 2 elements.<br>
The first one is called
<strong>“binarized_spatraster_corrected”</strong>. This is a Spatraster
containing binarised values that have been corrected according to the
definition used in the function. It is used in the next funciton of the
pipeline.<br>
The second element is called <strong>“Event_corrected”</strong>. This is
a list with one data.table per pixel. Each data.table has a date for
each row (and as many dates as there are layers in YourSpatraster).</p>
<p>COLUMNS MEANNINGS :<br>
The “original_value” column gives the value of the raw binarisation
before applying this function.<br>
“cleaned_value” provides the corrected values for each date.<br>
“ID” is the identifier of the event, built using the pixel number, the
first day of the event and the last day of the event and the event_id
for that pixel. ID and event_id are proper to each pixel.<br>
“Duration” indicates the duration (in days) of the event.<br>
“Date” indicates the date corresponding to the row.</p>
</div>
</div>
<div class="section level2">
<h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>The <em>BEE.calc.corrections()</em> function allows to check how many
modifications your choices of settings in BEE.calc.tru_event have
induced compare to row binerized data. Please check <em>3.bis. Check the
number of modifications induced by the BEE.calc.true_event()
settings.</em></p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="load-data">Load data:<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/VicoMarbec/BioExtremeEvent" class="external-link">BioExtremeEvent</a></span><span class="op">)</span></span>
<span><span class="co">#Binarized spatraster built using BEE.calc.binarize()</span></span>
<span><span class="va">file_name_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"copernicus_binarized.tiff"</span><span class="op">)</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">"BioExtremeEvent"</span><span class="op">)</span></span>
<span><span class="va">binarized_data</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">file_name_1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-filter">Apply filter:<a class="anchor" aria-label="anchor" href="#apply-filter"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binarized_EE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BEE.calc.true_event.html">BEE.calc.true_event</a></span><span class="op">(</span>binarized_spatraster <span class="op">=</span> <span class="va">binarized_data</span>, n <span class="op">=</span> <span class="fl">5</span>, d <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatraster-output">Spatraster output:<a class="anchor" aria-label="anchor" href="#spatraster-output"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the corrected spatraster:</span></span>
<span><span class="va">binarized_corrected_spatraster</span> <span class="op">&lt;-</span> <span class="va">binarized_EE</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot a layer</span></span>
<span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">binarized_corrected_spatraster</span><span class="op">[[</span><span class="fl">850</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">binarized_corrected_spatraster</span><span class="op">[[</span><span class="fl">850</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="3.1_calc_true_event_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here 850 refers to the layers of the spatraster &lt;-&gt; 850th days of the spatraster.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-the-list-of-data-table-with-former-and-corrected-values-and-with-dates-and-duration">Get the list of data.table with former and corrected values and with
dates and duration:<a class="anchor" aria-label="anchor" href="#get-the-list-of-data-table-with-former-and-corrected-values-and-with-dates-and-duration"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binarized_corrected_df</span> <span class="op">&lt;-</span> <span class="va">binarized_EE</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">binarized_corrected_df</span><span class="op">[[</span><span class="fl">80</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   pixel_id original_value cleanned_value event_id duration       date</span></span>
<span><span class="co">## 1       80              1              0        1      196 2023-01-01</span></span>
<span><span class="co">## 2       80              0              0        1      196 2023-01-02</span></span>
<span><span class="co">## 3       80              0              0        1      196 2023-01-03</span></span>
<span><span class="co">## 4       80              0              0        1      196 2023-01-04</span></span>
<span><span class="co">## 5       80              0              0        1      196 2023-01-05</span></span>
<span><span class="co">## 6       80              0              0        1      196 2023-01-06</span></span>
<span><span class="co">##                           ID</span></span>
<span><span class="co">## 1 80_2023-01-01_2023-07-15_1</span></span>
<span><span class="co">## 2 80_2023-01-01_2023-07-15_1</span></span>
<span><span class="co">## 3 80_2023-01-01_2023-07-15_1</span></span>
<span><span class="co">## 4 80_2023-01-01_2023-07-15_1</span></span>
<span><span class="co">## 5 80_2023-01-01_2023-07-15_1</span></span>
<span><span class="co">## 6 80_2023-01-01_2023-07-15_1</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here 80 refers to the pixel id. The 850th day correspond to the 850th row.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-to-save-the-ouputs">How to save the ouputs:<a class="anchor" aria-label="anchor" href="#how-to-save-the-ouputs"></a>
</h3>
<p>Due to the different nature of the two outputs, they must be saved
separately.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Save the spatraster</span></span>
<span><span class="va">binarized_corrected_spatraster</span> <span class="op">&lt;-</span> <span class="va">binarized_EE</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">binarized_corrected_spatraster</span>, <span class="st">"your_path/data/binarized_corrected_spatraster.tiff"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Save the list of df</span></span>
<span><span class="va">binarized_corrected_df</span> <span class="op">&lt;-</span> <span class="va">binarized_EE</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">binarized_corrected_df</span>, file <span class="op">=</span> <span class="st">"your_path/data/binarized_corrected_df.rds"</span><span class="op">)</span></span></code></pre></div>
<p>Please save both because they are both used in the next steps of the
pipeline.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Victoria Delannoy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
