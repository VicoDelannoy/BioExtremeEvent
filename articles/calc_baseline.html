<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Compute a baseline value • BioExtremeEvent</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Compute a baseline value">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioExtremeEvent</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/BioExtremeEvent.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calc_baseline.html">1. Compute a baseline value</a>
    </li>
    <li>
      <a href="../articles/calc_binarize.html">2. Compare a time serie with the baseline or fixed threshold</a>
    </li>
    <li>
      <a href="../articles/calc_celsius.html">0.bis. Convert temperature data to Celsius</a>
    </li>
    <li>
      <a href="../articles/calc_true_event.html">3. Identify extreme event according specific constraints</a>
    </li>
    <li>
      <a href="../articles/data_load_corpernicus.html">0. Dowload data from Copernicus</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/VicoMarbec/BioExtremeEvent/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Compute a baseline value</h1>
                        <h4 data-toc-skip class="author">Victoria
Delannoy, Nicolas Loiseau, Sébastien Villéger</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/VicoMarbec/BioExtremeEvent/blob/main/vignettes/calc_baseline.Rmd" class="external-link"><code>vignettes/calc_baseline.Rmd</code></a></small>
      <div class="hidden name"><code>calc_baseline.Rmd</code></div>

    </div>

    
    
<p>In this pipeline, an extreme event is identified in a given location
if the value of the studied parameter exceeds a reference value. This
reference value can be fixed over time, as with a biologically defined
threshold or an absolute physical limit. Alternatively, it can be
derived from the distribution of a historical time series. In this
frequentist approach, the threshold is defined as a given percentile of
the observed values. For example, if a 90^th percentile thershold is
used, a daily value will be considered as ‘extreme’ if it is higher than
90 % of the values observed for the same day of the years across all the
years that are used as reference. This second approach is commonly used
when there are no <em>a priori</em> hypotheses about what values
constitues an extreme value for the studdied ecosystem, and when the
hypothesis is that anything more intense than what the ecosystem is
accoustomed to may induce unusual modifications. Alternatively, the mean
value observed in the time series can be used to compute a daily
baseline value. To proceed accroding to this method, the pipeline
involves three steps :<br>
- First, the baseline value is computed using the
<em>BEE.calc.baseline()</em> function.<br>
- Then, each day of the studied time period is compared to the baseline
value, and days above (or below) the threshold are identified using
<em>BEE.calc.binarize()</em>. If you are working with a fixed baseline,
you can skip <em>BEE.calc.baseline()</em> and go straight to
<em>BEE.calc.binarize()</em>.<br>
- Finally, you can apply a filter to <em>BEE.calc.binarize()</em> output
to add additional criteria to the ‘extreme event’ definition. This could
be a minimum duration or a tolerance of a certain number of days below
the baseline value within an extreme event. See
<em>BEE.calc.true_event()</em>.</p>
<div class="section level2">
<h2 id="aims-of-the-function-bee-calc-baseline">Aims of the function <em>BEE.calc.baseline()</em><a class="anchor" aria-label="anchor" href="#aims-of-the-function-bee-calc-baseline"></a>
</h2>
<p><em>BEE.calc.baseline()</em> computes the daily baseline value for
each day. You can choose the percentile value to use when computing your
baseline. Futher along the pipeline, this baseline is used to identify
extreme event and compute some metrics about the extreme event.</p>
</div>
<div class="section level2">
<h2 id="data-for-this-tutorial">Data for this tutorial<a class="anchor" aria-label="anchor" href="#data-for-this-tutorial"></a>
</h2>
<p>copernicus_data_celsius is a spatraster form copernicus, converted
from Kelvin to celsius using BEE.calc.celsius(). It has one layer per
day between 2023-01-01 and 2025-12-31 and cover around 10 000 km² in the
corner of the gulf of lion. See article <em>0. Download data from
Copernicus</em> for more informations and <em>0.bis. Convert tempreature
data to Celsius</em>.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="arguments">Arguments:<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h3>
<p><strong>YourSpatraster</strong> is a spatraster with one layer per
day. Each layer covers the same area, and the time series must encompass
the start_date and end_date provided as argument.<br><strong>start_date</strong> and <strong>end_date</strong> are the limits
of the time period you want to consider has the reference value to
compute the baseline. Please ensure that the date format matches that of
the provided spatraster. You can check the format using
terra::time(YourSpatraster).<br><strong>threshold</strong> is the argument specifying whether you want
to compute a percentile value of the time serie or the mean value.
Arguments accepted are:<br>
- <em>“qt”</em> (quantile), to calculate a percentile. -
<em>“mean”</em>, to calculate the mean value across the time
serie.<br><strong>quantile_value</strong> is a numerical argument to specify the
value of the quantile you want to compute. If threshold = “mean”, the
quantile_value argument will be ignored.<br><strong>time_window</strong> number of days on either side of day ‘d’
that are used to calculate the threshold value associated for day ‘d’.
For example, if <em>“time_window = 5”</em>, the thershold value for ‘d’
day will be calculated using data from five days before day d, day d
itself, and the five days after day d, from all years between
<em>“start_date”</em> and <em>“end_date”</em>. See ‘Examples’ section
below to see how it can affect baseline value.<br>
Warning: this argument is not related to the minimum number of days
required to distinguish an ‘extreme day’ from an ‘extreme event’. This
will be addressed later in the BEE.calc.true_event() function.
<strong>smooth_window</strong> number of days on either side of day ‘d’
that are used to calculate the mean value of the threshold assigned to
the ‘d’ day. This allows your threshold value to be smoothed across
days. For example, if <em>“smooth_window”</em> is set to 10 days, the
final value on day ‘d’ will be the mean of the baseline/thershold values
calculated for days: d - 10 to d + 10 (eleven values). See ‘Examples’
section below to see how it can affect baseline value.</p>
</div>
<div class="section level3">
<h3 id="warnings">Warnings:<a class="anchor" aria-label="anchor" href="#warnings"></a>
</h3>
<p>You will receive a warning if :</p>
<ul>
<li>
<em>“start_date”</em> and/or <em>“end_date”</em> provided are not
within the dates of the providid spatraster.</li>
<li>
<em>“start_date”</em> and/or <em>“end_date”</em> are in a different
format than the dates of the provided spatraster.</li>
</ul>
</div>
<div class="section level3">
<h3 id="messages">Messages:<a class="anchor" aria-label="anchor" href="#messages"></a>
</h3>
<p>You will receive a message if :</p>
<ul>
<li>You have not provided a <em>“start_date”</em> and/or an
<em>“end_date”</em>. The message will informed you about the dates used
as default <em>“start_date”</em> and/or <em>“end_date”</em>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Calculate the baseline value for each day of a year using the 90^th
percentile threshold and all values between d-5 and d+5. Then smothing
over a 15 days period centred on the d day:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/VicoMarbec/BioExtremeEvent" class="external-link">BioExtremeEvent</a></span><span class="op">)</span></span>
<span><span class="co">#### Smoothing over 15 days: # 18s to run</span></span>
<span><span class="va">baseline_qt90_smth_15</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BEE.calc.baseline.html">BEE.calc.baseline</a></span><span class="op">(</span>YourSpatraster <span class="op">=</span> <span class="va">copernicus_data_celsius</span>,</span>
<span>                                    start_date <span class="op">=</span> <span class="st">"2023-01-01"</span>,</span>
<span>                                    end_date <span class="op">=</span> <span class="st">"2025-12-31"</span>,</span>
<span>                                    threshold <span class="op">=</span> <span class="st">"qt"</span>,</span>
<span>                                    quantile_value <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                                    time_window <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                    smooth_window <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="co">#7+1+7=15</span></span></code></pre></div>
<p>For a given pixel, it produces a baseline value for each day of the
year:</p>
<p>The shorter the reference time series, the more useful the
‘time_window’ argument is for dealing with NA days and avoiding
distortion of the baseline by a few peaks events.<br>
The <em>“smoothing_window”</em> reduces day-to-day discontinuity. It is
particularly useful when time series are short and erratic, but it tends
to ‘flatten’ seasonal steep slopes, peaks and trough. The following
examples illustrate how these two arguments can modify the obtained
baseline:<br>
*For the purpose of this example, baseline is computed on a large
spatraster than the one commonly use in this tutorial. The following
arguments are used in all the graphs below:<br>
- start_date = “1982-01-01” - end_date = “2010-12-31” - threshold = “qt”
- quantile_value = 0.9</p>
<div class="figure" style="text-align: center">
<img src="baseline_vignette.png" class="r-plt" alt="Baseline values according combinaisons of *time_window* and *smoothing_window*" width="681"><p class="caption">
Baseline values according combinaisons of <em>time_window</em> and
<em>smoothing_window</em>
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Victoria Delannoy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
